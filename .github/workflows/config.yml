name: UI Tests
on: [push]
jobs:
  ui-tests:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - name: Run UI-Tests via docker-compose

        run: docker-compose up --exit-code-from my_tests || true

      - name: Generate Allure report
        run: sudo docker-compose run my_tests allure generate ./reports/allure-results --clean -o allure-report

      - name: Get Allure history
        uses: actions/checkout@v3
        if: always()
        continue-on-error: true
        with:
          ref: gh-pages
          path: gh-pages

      - name: Allure Report Action
        uses: simple-elf/allure-report-action@v1.7
        if: always()
        with:
          allure_results: allure-results
          allure_history: allure-history